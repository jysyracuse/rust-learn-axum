# Rust Learning Project

This is a Rust project that demonstrates basic CRUD operations and authentication using Axum as a web framework and Rust-Prisma-Client as the ORM.

## Prerequisites

### Clone the repository

### Install Rust and Database

### Create a new database and add its connection URL to the .env file
```sh
HOST=localhost
PORT=9001
JWT_SECRET=****
DATABASE_URL=mysql://xxx:xxx@localhost:3306/rust_learn # modify to your db path
```

### Generate the database schema and migrations:
```sh
cargo prisma db push --schema ./prisma/core.prisma
```

### Start the server
```sh
cargo watch -x 'run --bin rust_learn' # or whatever you named the project in Cargo.toml, can not just 'run' because there will be a prisma.rs in bin generated by orm
```

## Endpoints

POST /login
Authenticates a user and returns a JWT cookie in the response. The user's credentials are specified in the request body.

POST /register
Registers a new user and returns the user ID in the response. The user's name and password are specified in the request body.

GET /api/users
Retrieves a list of users based on query parameters (page, page_size, and status) and returns them in a JSON response. This endpoint is protected with a JWT cookie authentication middleware.

GET /api/users/:user_id
Retrieves a single user based on the user ID specified in the path parameter and returns the user data in a JSON response. This endpoint is also protected with a JWT cookie authentication middleware.

POST /api/users/:user_id/update_password
Updates the password of a user specified by the user ID path parameter with a new password provided in the request body. This endpoint is protected with a JWT cookie authentication middleware and requires the user to provide their current password as well as the new password (which must match).

POST /api/users/:user_id/update_status
Updates the status of a user specified by the user ID path parameter with a new status provided in the request body. This endpoint is protected with a JWT cookie authentication middleware and can only be used by the user whose ID matches the one specified in the path parameter.

DELETE /api/users/:user_id
Deletes a user specified by the user ID path parameter. This endpoint is protected with a JWT cookie authentication middleware and can only be used by a user who is not trying to delete their own account.

## ORM

This project uses Rust-Prisma-Client as the ORM to interact with database. Rust-Prisma-Client generates Rust structs and functions based on the database schema defined in Prisma, allowing for type-safe queries and easy database migrations.

To generate the Rust code based on the database schema, run prisma generate after making any changes to the schema in the schema.prisma file. Rust-Prisma-Client also provides a query builder API that allows you to write type-safe queries in Rust code.

The db module in this project contains the Rust-Prisma-Client database client instance and the ORM models for the user entity. These models define the fields and relationships for the user entity and provide methods for querying and manipulating user records.

## Authentication

This project uses JSON Web Tokens (JWTs) as the authentication mechanism. When a user logs in, the server generates a JWT and sends it to the client in a cookie. Subsequent requests to authenticated endpoints include the JWT cookie, which the server validates to ensure that the user is authorized to access the requested resource.

The auth module in this project contains the JWT cookie authentication middleware, which checks for the presence and validity of the JWT cookie before allowing access to an authenticated endpoint.

## License

This project is licensed under the MIT License.